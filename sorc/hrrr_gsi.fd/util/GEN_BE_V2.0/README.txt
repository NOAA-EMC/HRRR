#########################################################################
#
# GEN_BE Version 2.0
# Author: Gael DESCOMBES, NCAR/MMM June, 2014
# contact gael@ucar.edu 
#########################################################################

Based on:

G. Descombes, T. Auligné, F. Vandenberghe, D. M. Barker, and J. Barré, 2015:
Generalized background error covariance matrix model (GEN_BE v2.0)
Geosci. Model Dev., 8, 669-696, 2015
www.geosci-model-dev.net/8/669/2015/
doi:10.5194/gmd-8-669-2015

#------------------------------------------------------------------------
# 1.0 Configuration/Compilation
#------------------------------------------------------------------------

Source codes are in the directories:
- code/src: stage[0,1,2,3,4].F , gen_be_nc2gsi.F
- code/external: Useful modules and libraries
- code/scripts: Scripts to run the different components of GEN_BE.
                The gen_be_wrapper.ksh script and namelist_template need to be 
                filled out for specific applications.
                The script gen_be_set_defaults.ksh contains all the default options
- code/arch contains configuration options for compilation 

command 0: clean
command 1: configure (compilers)
command 2: compile gen_be
The executables are located in the code/src directory

#------------------------------------------------------------------------
# 2.0 How to run it?
#------------------------------------------------------------------------

The user needs to successively set stages 0, 1, 2, 3, and 4 in 
the gen_be_wrapper.ksh script to true:

export RUN_GEN_BE_STAGE0=true  # Run stage 0 (creates perturbation files).
export RUN_GEN_BE_STAGE1=false # Run stage 1 (removes mean, split variables).
export RUN_GEN_BE_STAGE2=false # Run stage 2 (applies balance operator).
export RUN_GEN_BE_STAGE3=false # Run stage 3 (calculates vertical correlation parameters).
export RUN_GEN_BE_STAGE4=false # Run stage 4 (calculates horizontal length scales).

Once the 4 stages are completed, the command export RUN_GEN_BE_DIAGS=true   
will generate the be.nc file (NetCDF) that gathers all the parameters 
that model BE. 

All the results are contained in the working directory (WORK_DIR).
(e.g. to the gen_be_wrapper.ksh for more details)

A converter for GSI application is available:
gen_be_nc2gsi.F
It will convert the be.nc file to a binary input file readable by GSI.

#-----------------------------------------------------------------------
# 3.0 Description of the test cases
#-----------------------------------------------------------------------

The 50 members of the ensemble forecast used for the test cases can be 
provided at request as well for the results (gael@ucar.edu). 

3.1. Benchmark

a. The test case Beof can be generated by using the namelist.input
and the option data_on_levels=.false. using CV5 (psi, chi, t, ps, rh)
located inside the benchmark directory.

b. The test case Brcf is generated by using the namelist.input
and the option data_on_levels=.true. using CV5 (psi, chi, t, ps, rh)
located inside the benchmark directory.


3.2. Evaluation of hydrometeor parameters (cloud, ice, rain, snow) 
Tests have been done according to the number of members 05, 10, 50,
located inside the hydrometeors/univariate directory.


3.3. Multivariate approach
Hydrometeor (cloud, ice) mixing ratios are correlated with relative 
humidity errors located inside the hydrometeors/multivariate directory. 


